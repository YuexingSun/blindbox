
<title>留存统计</title>

<div class="layui-card layadmin-header">
  <div class="layui-breadcrumb" lay-filter="breadcrumb">
    <a lay-href="">主页</a>
    <a><cite>留存统计</cite></a>
  </div>
</div>

<div class="layui-fluid">
  <div class="layui-row layui-col-space15">   
    <div class="layui-col-sm6 layui-col-md3">
      <div class="layui-card">
        <div class="layui-card-header">
          次日留存率
          
        </div>
        <div class="layui-card-body layuiadmin-card-list">
          <p class="layuiadmin-big-font" id="totalall"></p>
          <p>
            最高 
            <span class="layuiadmin-span-color" id="totalweek"></span><span class="layui-badge layui-bg-blue layuiadmin-badge">平均</span>
          </p>
        </div>
      </div>
    </div>
    <div class="layui-col-sm6 layui-col-md3">
      <div class="layui-card">
        <div class="layui-card-header">
          7日留存率
        </div>
        <div class="layui-card-body layuiadmin-card-list">
          <p class="layuiadmin-big-font" id="miniall"></p>
          <p>
            最高
            <span class="layuiadmin-span-color" id="miniweek"></span><span class="layui-badge layui-bg-blue layuiadmin-badge">平均</span>
          </p>
        </div>
      </div>
    </div>
    <div class="layui-col-sm6 layui-col-md3">
      <div class="layui-card">
        <div class="layui-card-header">
          开盒次数
        </div>
        <div class="layui-card-body layuiadmin-card-list">
          <p class="layuiadmin-big-font" id="appall"></p>
          <p>
            最高 
            <span class="layuiadmin-span-color" id="appweek"></span><span class="layui-badge layui-bg-blue layuiadmin-badge">平均</span>
          </p>
        </div>
      </div>
    </div>
    <div class="layui-col-sm6 layui-col-md3">
      <div class="layui-card">
        <div class="layui-card-header">
          人均开盒数
        </div>
        <div class="layui-card-body layuiadmin-card-list">
          <p class="layuiadmin-big-font" id="agvbox"></p>
          <p>
            &nbsp; 
            <span class="layuiadmin-span-color" id="appweek"></span>
          </p>
        </div>
      </div>
    </div>
        

    <div class="layui-col-sm12">
      <div class="layui-card">
        <div class="layui-card-header">
          最近30天次日留存率趋势
          <!-- <div class="layui-btn-group layuiadmin-btn-group">
            <button class="layui-btn layui-btn-primary layui-btn-xs">本月</button>
            <button class="layui-btn layui-btn-primary layui-btn-xs">全部</button>
          </div> -->
        </div>
        <div class="layui-card-body">
          <div class="layui-row">
            <div class="layui-col-sm12">
                <div class="layui-carousel layadmin-carousel layadmin-dataview" data-anim="fade" lay-filter="LAY-index-pagetwo">
                  <div carousel-item id="LAY-index-pagetwo">
                    <div><i class="layui-icon layui-icon-loading1 layadmin-loading"></i></div>
                  </div>
                </div>
            </div>
            <!-- <div class="layui-col-sm4">
              <div class="layuiadmin-card-list">
                <p class="layuiadmin-normal-font">月注册数</p>
                <span>同上期增长</span>
                <div class="layui-progress layui-progress-big" lay-showPercent="yes">
                  <div class="layui-progress-bar" lay-percent="30%"></div>
                </div>
              </div>
              <div class="layuiadmin-card-list">
                <p class="layuiadmin-normal-font">App端</p>
                <span>同上期增长</span>
                <div class="layui-progress layui-progress-big" lay-showPercent="yes">
                  <div class="layui-progress-bar" lay-percent="20%"></div>
                </div>
              </div>
              <div class="layuiadmin-card-list">
                <p class="layuiadmin-normal-font">小程序端</p>
                <span>同上期增长</span>
                <div class="layui-progress layui-progress-big" lay-showPercent="yes">
                  <div class="layui-progress-bar" lay-percent="25%"></div>
                </div>
              </div>
            </div> -->
          </div>
        </div>
      </div>
    </div>
    
        <!-- <div class="layui-col-sm12">
          <div class="layui-card">
            <div class="layui-card-header">用户全国分布</div>
            <div class="layui-card-body">
              <div class="layui-row layui-col-space15">
                <div class="layui-col-sm4">
                  <table class="layui-table layuiadmin-page-table" lay-skin="line">
                      <thead>
                        <tr>
                          <th>排名</th>
                          <th>地区</th>
                          <th>人数</th>
                        </tr> 
                      </thead>
                      <tbody>
                        <tr>
                          <td>1</td>
                          <td>浙江</td>
                          <td>62310</td>
                        </tr>
                        <tr>
                          <td>2</td>
                          <td>上海</td>
                          <td>59190</td>
                        </tr>
                        <tr>
                          <td>3</td>
                          <td>广东</td>
                          <td>55891</td>
                        </tr>
                        <tr>
                          <td>4</td>
                          <td>北京</td>
                          <td>51919</td>
                        </tr>  
                        <tr>
                          <td>5</td>
                          <td>山东</td>
                          <td>39231</td>
                        </tr>
                        <tr>
                          <td>6</td>
                          <td>湖北</td>
                          <td>37109</td>
                        </tr>
                      </tbody>
                    </table>
                </div>
                <div class="layui-col-sm8">
                  <div class="layui-carousel layadmin-carousel layadmin-dataview" data-anim="fade" lay-filter="LAY-index-pagethree">
                    <div carousel-item id="LAY-index-pagethree">
                      <div><i class="layui-icon layui-icon-loading1 layadmin-loading"></i></div>
                    </div>
                  </div>    
                </div>
              </div>
            </div>
          </div>
        </div>-->

    
  </div>
</div>

<script>

  //区块轮播切换
  layui.use(['admin', 'carousel', 'echarts'], function(){
    var $ = layui.$
    ,admin = layui.admin
    ,carousel = layui.carousel
    ,element = layui.element
    ,device = layui.device()
    ,echarts = layui.echarts;

    //轮播切换
    $('.layadmin-carousel').each(function(){
      var othis = $(this);
      carousel.render({
        elem: this
        ,width: '100%'
        ,arrow: 'none'
        ,interval: othis.data('interval')
        ,autoplay: othis.data('autoplay') === true
        ,trigger: (device.ios || device.android) ? 'click' : 'hover'
        ,anim: othis.data('anim')
      });
    });
    
    element.render('progress');

    admin.req({
      url : layui.setter.ApiUrl.HostAddress + layui.setter.ApiUrl.StatisticData   
      ,type:"GET"
      ,data:{"type":"box"}
      ,done: function(res){
        if (res.errorcode === 0)
        {
          $("#totalall").html(res.data.totalall);
          $("#totalweek").html(res.data.totalweek);
          $("#appall").html(res.data.appall);
          $("#appweek").html(res.data.appweek);
          $("#miniall").html(res.data.miniall);
          $("#miniweek").html(res.data.miniweek);
          $("#agvbox").html(res.data.agvbox);

            var echartsApp = [], options = [
              {
                tooltip : {
                  trigger: 'axis'
                },
                calculable : true,
                legend: {
                  data:['次日留存','当日用户','7日留存','开盒次数','选中开盒数','到达开盒数']
                },
                
                xAxis : [
                  {
                    type : 'category',
                    data : res.data.categorylist
                  }
                ],
                yAxis : [
                  {
                    type : 'value',
                    name : '',
                    axisLabel : {
                      formatter: '{value}'
                    }
                  },
                  {
                    type : 'value',
                    name : '',
                    axisLabel : {
                        formatter: '{value}'
                    }
                  }
                ],
                series : [
                  {
                    name:'次日留存',
                    type:'line',
                    data:res.data.totallist
                  },
                  {
                    name:'当日用户',
                    type:'line',
                    yAxisIndex: 1,
                    data:res.data.applist
                  },
                  {
                    name:'7日留存',
                    type:'line',
                    data:res.data.minilist
                  },
                  {
                    name:'开盒次数',
                    type:'line',
                    data:res.data.openlist
                  },
                  {
                    name:'选中开盒数',
                    type:'line',
                    data:res.data.selectedlist
                  },
                  {
                    name:'到达开盒数',
                    type:'line',
                    data:res.data.finishlist
                  },

                ]
              }
            ]
            ,elemDataView = $('#LAY-index-pagetwo').children('div')
            ,renderDataView = function(index){
              echartsApp[index] = echarts.init(elemDataView[index], layui.echartsTheme);
              echartsApp[index].setOption(options[index]);
              window.onresize = echartsApp[index].resize;
            };
            //没找到DOM，终止执行
            if(!elemDataView[0]) return;
            renderDataView(0);


        }
      }
    }); 






    
  });



</script>